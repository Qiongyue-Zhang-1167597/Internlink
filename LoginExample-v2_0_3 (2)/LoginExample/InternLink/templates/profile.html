{% extends 'userbase.html' %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h2>My Profile</h2>
            <hr>
            
            <div class="card">
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        
                        <h5 class="card-title">Basic Information</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" id="username" class="form-control" value="{{ profile.username }}" disabled readonly>
                                <div class="form-text">Username cannot be changed.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" id="email" class="form-control" value="{{ profile.email }}" disabled readonly>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="full_name" class="form-label">Full Name</label>
                            <input type="text" id="full_name" name="full_name" class="form-control" value="{{ profile.full_name or '' }}">
                        </div>

                        {% if session.role == 'student' %}
                        <hr>
                        <h5 class="card-title">Student Profile</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="university" class="form-label">University</label>
                                <input type="text" id="university" name="university" class="form-control" value="{{ profile.university or '' }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="course" class="form-label">Course</label>
                                <input type="text" id="course" name="course" class="form-control" value="{{ profile.course or '' }}">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="resume" class="form-label">Update Resume (PDF only)</label>
                            <input type="file" id="resume" name="resume" class="form-control" accept=".pdf">
                            {% if profile.resume_path %}
                            <div class="form-text">Current resume: <a href="{{ url_for('static', filename=profile.resume_path.replace('static/', '', 1)) }}" target="_blank">View</a></div>
                            {% else %}
                            <div class="form-text">You have not uploaded a resume yet.</div>
                            {% endif %}
                        </div>
                        {% endif %}

                        {% if session.role == 'employer' %}
                        <hr>
                        <h5 class="card-title">Employer Profile</h5>
                        <div class="mb-3">
                            <label for="company_name" class="form-label">Company Name</label>
                            <input type="text" id="company_name" name="company_name" class="form-control" value="{{ profile.company_name or '' }}">
                        </div>
                         <div class="mb-3">
                            <label for="company_website" class="form-label">Company Website</label>
                            <input type="url" id="company_website" name="company_website" class="form-control" value="{{ profile.company_website or '' }}">
                        </div>
                         <div class="mb-3">
                            <label for="company_description" class="form-label">Company Description</label>
                            <textarea id="company_description" name="company_description" class="form-control" rows="4">{{ profile.company_description or '' }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label for="company_logo" class="form-label">Update Company Logo</label>
                            <input type="file" id="company_logo" name="company_logo" class="form-control" accept="image/*">
                        </div>
                        {% endif %}
                        
                        {% if session.role|lower == 'admin' %}
                        <hr>
                        <h5 class="card-title">Admin Profile</h5>
                        <div class="mb-3">
                            <label for="full_name" class="form-label">Full Name</label>
                            <input type="text" id="full_name" name="full_name" class="form-control" value="{{ profile.full_name or '' }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" name="email" class="form-control" value="{{ profile.email }}" required>
                        </div>
                        {% else %}
                        <!-- 非admin显示disabled email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email (cannot be changed)</label>
                            <input type="email" id="email" class="form-control" value="{{ profile.email }}" disabled readonly>
                        </div>
                        {% endif %}

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title">Security</h5>
                    <p>Want to change your password?</p>
                    <a href="{{ url_for('user.change_password') }}" class="btn btn-secondary">Change Password</a>
                </div>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}